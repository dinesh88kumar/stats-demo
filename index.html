<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mini E-Commerce Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- ================= GOOGLE TAG ================= -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-R1M0DHDXJ5"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-R1M0DHDXJ5');
  </script>

  <!-- ================= TRIPLE WHALE ================= -->
  <link rel="preconnect dns-prefetch" href="https://api.config-security.com/" crossorigin />
  <link rel="preconnect dns-prefetch" href="https://conf.config-security.com/" crossorigin />
  <script>
  window.TriplePixelData = {
    TripleName: "dinesh88kumar.github.io",
    ver: "2.17",
    plat: "SHOPIFY",
    isHeadless: true
  };
  (function(W,H,A,L,E,_,B,N){
    function O(U,T,P,H,R){
      void 0===R&&(R=!1),H=new XMLHttpRequest,
      P?(H.open("POST",U,!0),H.setRequestHeader("Content-Type","text/plain"))
       :H.open("GET",U,!0),
      H.send(JSON.stringify(P||{})),
      H.onreadystatechange=function(){
        4===H.readyState&&200===H.status
        ?(R=H.responseText,U.includes("/first")?eval(R):P||(N[B]=R))
        :(299<H.status||H.status<200)&&T&&!R&&(R=!0,O(U,T-1,P))
      }
    }
    if(N=window,!N[H+"sn"]){
      N[H+"sn"]=1;
      L=function(){return Date.now().toString(36)+"_"+Math.random().toString(36)};
      try{
        A.setItem(H,1+(0|A.getItem(H)||0)),
        (E=JSON.parse(A.getItem(H+"U")||"[]"))
        .push({u:location.href,r:document.referrer,t:Date.now(),id:L()}),
        A.setItem(H+"U",JSON.stringify(E))
      }catch(e){}
      var i,m,p;
      A.getItem('"!nC`')||(
        _=A,A=N,
        A[H]||(E=A[H]=function(t,e,a){
          return void 0===a&&(a=[]),
          "State"==t?E.s:(W=L(),(E._q=E._q||[]).push([W,t,e].concat(a)),W)
        }),
        E.s="Installed",E._q=[],E.ch=W,
        B="configSecurityConfModel",N[B]=1,
        O("https://conf.config-security.com/model",5),
        i=L(),m=A[atob("c2NyZWVu")],
        _.setItem("di_pmt_wt",i),
        p={
          id:i,
          action:"profile",
          host:A.TriplePixelData.TripleName,
          plat:A.TriplePixelData.plat,
          url:window.location.href.slice(0,500),
          ref:document.referrer,
          ver:A.TriplePixelData.ver
        },
        O("https://api.config-security.com/event",5,p),
        O("https://api.config-security.com/first?host=dinesh88kumar.github.io&plat=SHOPIFY",5)
      )
    }
  })("","TriplePixel",localStorage);
  </script>

  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f8fafc;
      padding: 30px;
    }
    .products {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
    }
    .card {
      background: white;
      padding: 16px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,.1);
    }
    button {
      background: #2563eb;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>

<body>
<h1>ðŸ›’ Mini E-Commerce Store</h1>

<div class="products" id="product-list"></div>

<h2>ðŸ§¾ Cart</h2>
<ul id="cart-items"></ul>
<p>Total: â‚¹<span id="total">0</span></p>

<input id="coupon" placeholder="Coupon code" />
<button onclick="purchase()">Buy</button>
<p id="msg"></p>

<script>
  const products = [
    { id: 1, name: "JavaScript Book", price: 500 },
    { id: 2, name: "Python Book", price: 600 },
    { id: 3, name: "Headphones", price: 1500 }
  ];

  let cart = [];

  function renderProducts() {
    document.getElementById("product-list").innerHTML =
      products.map(p => `
        <div class="card">
          <h3>${p.name}</h3>
          <p>â‚¹${p.price}</p>
          <button onclick="addToCart(${p.id})">Add to Cart</button>
        </div>
      `).join("");
  }

  function addToCart(id) {
    const p = products.find(x => x.id === id);
    cart.push(p);
    updateCart();

    gtag("event", "add_to_cart", {
      item_name: p.name,
      value: p.price,
      currency: "INR"
    });
  }

  function updateCart() {
    let total = 0;
    document.getElementById("cart-items").innerHTML = cart.map(i => {
      total += i.price;
      return `<li>${i.name} - â‚¹${i.price}</li>`;
    }).join("");
    document.getElementById("total").innerText = total;
  }

  /* ================= PURCHASE + TRIPLE WHALE CONTACT ================= */
  function fireTripleContact(email) {
    (function TP() {
      if (!email || !window.TriplePixel) {
        setTimeout(TP, 400);
        return;
      }
      TriplePixel("Contact", { email: email });
    })();
  }

  function purchase() {
    if (!cart.length) return;

    const code = document.getElementById("coupon").value.trim();
    let total = cart.reduce((s, i) => s + i.price, 0);

    if (code.startsWith("FREE")) total = 0;

    // Simulated customer email
    const customerEmail = "customer_" + Date.now() + "@example.com";

    gtag("event", "purchase", {
      value: total,
      currency: "INR",
      coupon: code || undefined
    });

    fireTripleContact(customerEmail);

    document.getElementById("msg").innerText =
      `âœ… Purchase complete. Email tracked: ${customerEmail}`;

    cart = [];
    updateCart();
  }

  renderProducts();
</script>
</body>
</html>
